<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>옵션표 생성기</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 520px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    
    /* 메인 탭 */
    .main-tabs {
      display: flex;
      margin-bottom: 12px;
      background: #fff;
      border-radius: 12px;
      padding: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    
    .main-tab-btn {
      flex: 1;
      padding: 11px;
      border: none;
      background: transparent;
      color: #999;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .main-tab-btn.active {
      background: #1e3a5f;
      color: white;
    }
    
    /* 서브 탭 */
    .sub-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .sub-tab-btn {
      flex: 1;
      padding: 10px;
      border: 1px solid #e5e7eb;
      background: #fff;
      color: #6b7280;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .sub-tab-btn.active {
      border-color: #1e3a5f;
      background: #f0f4f8;
      color: #1e3a5f;
    }
    
    /* 입력 폼 */
    .form-panel {
      display: none;
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    
    .form-panel.active { display: block; }
    
    .section-title {
      font-size: 12px;
      font-weight: 700;
      color: #1e3a5f;
      margin: 20px 0 12px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .section-title:first-child { margin-top: 0; }
    
    .form-row {
      margin-bottom: 10px;
    }
    
    .form-row label {
      display: block;
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .form-row input,
    .form-row select,
    .form-row textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #fff;
      color: #111;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .form-row select {
      padding-right: 12px;
    }
    
    .form-row input:focus,
    .form-row select:focus,
    .form-row textarea:focus {
      outline: none;
      border-color: #1e3a5f;
      box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
    }
    
    .form-row input::placeholder,
    .form-row textarea::placeholder {
      color: #9ca3af;
    }
    
    .form-row textarea {
      min-height: 70px;
      resize: vertical;
      line-height: 1.5;
    }
    
    .inline-group {
      display: flex;
      gap: 8px;
    }
    
    .inline-group select {
      width: 110px;
      flex-shrink: 0;
    }
    
    .inline-group input { flex: 1; }
    
    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 3px;
    }
    
    /* 결과 모달 */
    .result-panel { display: none; }
    .result-panel.active { 
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .modal-container {
      background: #fff;
      border-radius: 16px;
      max-width: 95vw;
      max-height: 95vh;
      overflow: auto;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      display: flex;
      gap: 10px;
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      background: #fff;
      border-radius: 16px 16px 0 0;
      z-index: 10;
    }
    
    .modal-header .btn {
      flex: none;
      padding: 10px 24px;
    }
    
    .modal-body {
      padding: 20px;
      overflow: auto;
    }
    
    #camper-result-container,
    #caravan-result-container {
      background: #fff;
      width: 800px;
      padding: 24px;
    }
    
    /* 2열 그리드 */
    .result-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    /* 카드 스타일 */
    .result-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .result-card-header {
      background: #1e3a5f;
      color: white;
      padding: 14px 20px;
      font-size: 15px;
      font-weight: 700;
    }
    
    .result-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .result-table tr {
      border-bottom: 1px solid #e5e7eb;
    }
    
    .result-table tr:last-child {
      border-bottom: none;
    }
    
    .result-table td {
      padding: 14px 20px;
      font-size: 14px;
      vertical-align: middle;
    }
    
    .result-table td:first-child {
      background: #f8f9fa;
      color: #888;
      font-weight: 500;
      width: 40%;
      border-right: 1px solid #e5e7eb;
    }
    
    .result-table td:last-child {
      background: #fff;
      color: #222;
      font-weight: 600;
    }
    
    /* 옵션 카드 */
    .option-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .option-card-header {
      background: #1e3a5f;
      color: white;
      padding: 14px 20px;
      font-size: 15px;
      font-weight: 700;
    }
    
    .option-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .option-table tr {
      border-bottom: 1px solid #e5e7eb;
    }
    
    .option-table tr:last-child {
      border-bottom: none;
    }
    
    .option-table td {
      padding: 16px 20px;
      font-size: 14px;
      vertical-align: top;
    }
    
    .option-table td:first-child {
      background: #f8f9fa;
      color: #888;
      font-weight: 500;
      width: 100px;
      border-right: 1px solid #e5e7eb;
      text-align: center;
      vertical-align: middle;
    }
    
    .option-table td:last-child {
      background: #fff;
      color: #222;
      line-height: 1.8;
    }
    
    .electric-items {
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }
    
    .electric-items span {
      font-weight: 500;
    }
    
    /* 버튼 */
    .btn-group {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }
    
    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: #1e3a5f;
      color: white;
    }
    
    .btn-primary:hover {
      background: #152a45;
    }
    
    .btn-download {
      background: #2563eb;
      color: white;
    }
    
    .btn-download:hover {
      background: #1d4ed8;
    }
    
    .btn-reset {
      background: #f3f4f6;
      color: #6b7280;
    }
    
    .btn-reset:hover {
      background: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 메인 탭 -->
    <div class="main-tabs">
      <button class="main-tab-btn active" onclick="switchMainTab('camper')">캠핑카</button>
      <button class="main-tab-btn" onclick="switchMainTab('caravan')">카라반</button>
    </div>
    
    <!-- 서브 탭 -->
    <div class="sub-tabs">
      <button class="sub-tab-btn active" onclick="switchSubTab('input')">입력</button>
      <button class="sub-tab-btn" onclick="switchSubTab('result')">결과 미리보기</button>
    </div>
    
    <!-- 캠핑카 입력 -->
    <div id="camper-input" class="form-panel active">
      <div class="section-title">차량 정보</div>
      <div class="form-row">
        <label>베이스 차량</label>
        <input type="text" id="c-baseVehicle" placeholder="예: 현대 쏠라티">
      </div>
      <div class="form-row">
        <label>제조사</label>
        <input type="text" id="c-manufacturer" placeholder="예: 코치맨(CM카라반)">
      </div>
      <div class="form-row">
        <label>모델명</label>
        <input type="text" id="c-modelName" placeholder="예: VIP 560">
      </div>
      <div class="form-row">
        <label>차종</label>
        <select id="c-vehicleType">
          <option value="소형 특수">소형 특수</option>
          <option value="중형 특수">중형 특수</option>
          <option value="중형 승합">중형 승합</option>
          <option value="소형 화물">소형 화물</option>
        </select>
      </div>
      <div class="form-row">
        <label>연식</label>
        <input type="text" id="c-year" placeholder="2021 또는 2021.3">
        <div class="hint">2021 → 연식 / 2021.3 → 제작연월</div>
      </div>
      <div class="form-row">
        <label>최초등록일</label>
        <input type="text" id="c-firstReg" placeholder="예: 2021.3">
        <div class="hint">2021.3 → 2021 년 3 월</div>
      </div>
      <div class="form-row">
        <label>주행거리</label>
        <input type="text" id="c-mileage" placeholder="예: 35000">
      </div>
      <div class="form-row">
        <label>차고지 증명</label>
        <select id="c-garageProof">
          <option value="불필요">불필요</option>
          <option value="필요(도와드릴게요)">필요(도와드릴게요)</option>
        </select>
      </div>
      <div class="form-row">
        <label>필요 면허</label>
        <select id="c-license">
          <option value="1종 보통면허">1종 보통면허</option>
          <option value="1종 대형면허">1종 대형면허</option>
          <option value="2종 보통면허">2종 보통면허</option>
        </select>
      </div>
      
      <div class="section-title">제원</div>
      <div class="form-row">
        <label>길이 (mm)</label>
        <input type="text" id="c-length" placeholder="예: 7315">
      </div>
      <div class="form-row">
        <label>너비 (mm)</label>
        <input type="text" id="c-width" placeholder="예: 2060">
      </div>
      <div class="form-row">
        <label>높이 (mm)</label>
        <input type="text" id="c-height" placeholder="예: 2850">
      </div>
      <div class="form-row">
        <label>배기량 (cc)</label>
        <input type="text" id="c-displacement" placeholder="예: 2497">
      </div>
      <div class="form-row">
        <label>연료</label>
        <select id="c-fuel">
          <option value="휘발유">휘발유</option>
          <option value="경유">경유</option>
          <option value="LPG">LPG</option>
        </select>
      </div>
      <div class="form-row">
        <label>변속기</label>
        <select id="c-transmission">
          <option value="자동">자동</option>
          <option value="수동">수동</option>
        </select>
      </div>
      <div class="form-row">
        <label>연비 (km/L)</label>
        <input type="text" id="c-fuelEconomy" placeholder="예: 8.5">
      </div>
      <div class="form-row">
        <label>승차정원</label>
        <input type="text" id="c-seatCapacity" placeholder="예: 9">
      </div>
      <div class="form-row">
        <label>현금 영수증</label>
        <select id="c-cashReceipt">
          <option value="가능">가능</option>
          <option value="불가능">불가능</option>
        </select>
      </div>
      
      <div class="section-title">전기</div>
      <div class="form-row">
        <label>배터리</label>
        <div class="inline-group">
          <select id="c-batteryType">
            <option value="인산철" selected>인산철</option>
            <option value="딥싸이클">딥싸이클</option>
          </select>
          <input type="text" id="c-batteryCapacity" placeholder="예: 300">
        </div>
      </div>
      <div class="form-row">
        <label>태양광 (W)</label>
        <input type="text" id="c-solar" placeholder="예: 180">
      </div>
      <div class="form-row">
        <label>인버터 (Kw)</label>
        <input type="text" id="c-inverter" placeholder="예: 3">
      </div>
      
      <div class="section-title">옵션</div>
      <div class="form-row">
        <label>외관</label>
        <textarea id="c-exterior" placeholder="스페이스 2번으로 구분"></textarea>
        <div class="hint">스페이스 2번 → 자동으로 • 변환</div>
      </div>
      <div class="form-row">
        <label>내장</label>
        <textarea id="c-interior" placeholder="스페이스 2번으로 구분"></textarea>
      </div>
      <div class="form-row">
        <label>편의</label>
        <textarea id="c-convenience" placeholder="스페이스 2번으로 구분"></textarea>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-reset" onclick="resetForm('camper')">초기화</button>
        <button class="btn btn-primary" onclick="switchSubTab('result')">미리보기 →</button>
      </div>
    </div>
    
    <!-- 카라반 입력 -->
    <div id="caravan-input" class="form-panel">
      <div class="section-title">차량 정보</div>
      <div class="form-row">
        <label>제조사</label>
        <input type="text" id="v-manufacturer" placeholder="예: 코치맨(CM카라반)">
      </div>
      <div class="form-row">
        <label>모델명</label>
        <input type="text" id="v-modelName" placeholder="예: VIP 560">
      </div>
      <div class="form-row">
        <label>차종</label>
        <select id="v-vehicleType">
          <option value="소형 특수">소형 특수</option>
          <option value="중형 특수">중형 특수</option>
          <option value="중형 승합">중형 승합</option>
          <option value="소형 화물">소형 화물</option>
        </select>
      </div>
      <div class="form-row">
        <label>연식</label>
        <input type="text" id="v-year" placeholder="2021 또는 2021.3">
        <div class="hint">2021 → 연식 / 2021.3 → 제작연월</div>
      </div>
      <div class="form-row">
        <label>최초등록일</label>
        <input type="text" id="v-firstReg" placeholder="예: 2021.3">
        <div class="hint">2021.3 → 2021 년 3 월</div>
      </div>
      <div class="form-row">
        <label>차고지 증명</label>
        <select id="v-garageProof">
          <option value="불필요">불필요</option>
          <option value="필요(도와드릴게요)">필요(도와드릴게요)</option>
        </select>
      </div>
      <div class="form-row">
        <label>취침인원</label>
        <input type="text" id="v-sleepCapacity" placeholder="예: 4">
      </div>
      <div class="form-row">
        <label>현금 영수증</label>
        <select id="v-cashReceipt">
          <option value="가능">가능</option>
          <option value="불가능">불가능</option>
        </select>
      </div>
      
      <div class="section-title">제원</div>
      <div class="form-row">
        <label>외부 길이 (mm)</label>
        <input type="text" id="v-extLength" placeholder="예: 7315">
      </div>
      <div class="form-row">
        <label>내부 길이 (mm)</label>
        <input type="text" id="v-intLength" placeholder="예: 5660">
      </div>
      <div class="form-row">
        <label>외부 너비 (mm)</label>
        <input type="text" id="v-extWidth" placeholder="예: 2320">
      </div>
      <div class="form-row">
        <label>내부 너비 (mm)</label>
        <input type="text" id="v-intWidth" placeholder="없으면 비워두세요">
      </div>
      <div class="form-row">
        <label>외부 높이 (mm)</label>
        <input type="text" id="v-extHeight" placeholder="예: 2650">
      </div>
      <div class="form-row">
        <label>내부 높이 (mm)</label>
        <input type="text" id="v-intHeight" placeholder="예: 1955">
      </div>
      <div class="form-row">
        <label>공차 중량 (kg)</label>
        <input type="text" id="v-curbWeight" placeholder="예: 1450">
      </div>
      <div class="form-row">
        <label>최대 허용 중량 (kg)</label>
        <input type="text" id="v-maxWeight" placeholder="예: 1800">
      </div>
      
      <div class="section-title">전기</div>
      <div class="form-row">
        <label>배터리</label>
        <div class="inline-group">
          <select id="v-batteryType">
            <option value="인산철" selected>인산철</option>
            <option value="딥싸이클">딥싸이클</option>
          </select>
          <input type="text" id="v-batteryCapacity" placeholder="예: 200">
        </div>
      </div>
      <div class="form-row">
        <label>태양광 (W)</label>
        <input type="text" id="v-solar" placeholder="예: 180">
      </div>
      <div class="form-row">
        <label>인버터 (Kw)</label>
        <input type="text" id="v-inverter" placeholder="예: 2">
      </div>
      
      <div class="section-title">옵션</div>
      <div class="form-row">
        <label>외관</label>
        <textarea id="v-exterior" placeholder="스페이스 2번으로 구분"></textarea>
        <div class="hint">스페이스 2번 → 자동으로 • 변환</div>
      </div>
      <div class="form-row">
        <label>내장</label>
        <textarea id="v-interior" placeholder="스페이스 2번으로 구분"></textarea>
      </div>
      <div class="form-row">
        <label>편의</label>
        <textarea id="v-convenience" placeholder="스페이스 2번으로 구분"></textarea>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-reset" onclick="resetForm('caravan')">초기화</button>
        <button class="btn btn-primary" onclick="switchSubTab('result')">미리보기 →</button>
      </div>
    </div>
    
    <!-- 캠핑카 결과 -->
    <div id="camper-result" class="result-panel">
      <div class="modal-container">
        <div class="modal-header">
          <button class="btn btn-primary" onclick="switchSubTab('input')">← 수정</button>
          <button class="btn btn-download" onclick="downloadPNG('camper')">PNG 다운로드</button>
        </div>
        <div class="modal-body">
          <div id="camper-result-container">
            <div class="result-grid">
              <div class="result-card">
                <div class="result-card-header">차량 정보</div>
                <table class="result-table">
                  <tr><td>베이스 차량</td><td id="rc-baseVehicle">-</td></tr>
                  <tr><td>제조사</td><td id="rc-manufacturer">-</td></tr>
                  <tr><td>모델명</td><td id="rc-modelName">-</td></tr>
                  <tr><td>차종</td><td id="rc-vehicleType">-</td></tr>
                  <tr><td id="rc-yearLabel">연식</td><td id="rc-year">-</td></tr>
                  <tr><td>최초등록일</td><td id="rc-firstReg">-</td></tr>
                  <tr><td>주행거리</td><td id="rc-mileage">-</td></tr>
                  <tr><td>차고지 증명</td><td id="rc-garageProof">-</td></tr>
                  <tr><td>필요 면허</td><td id="rc-license">-</td></tr>
                </table>
              </div>
              <div class="result-card">
                <div class="result-card-header">제원</div>
                <table class="result-table">
                  <tr><td>길이</td><td id="rc-length">-</td></tr>
                  <tr><td>너비</td><td id="rc-width">-</td></tr>
                  <tr><td>높이</td><td id="rc-height">-</td></tr>
                  <tr><td>배기량</td><td id="rc-displacement">-</td></tr>
                  <tr><td>연료</td><td id="rc-fuel">-</td></tr>
                  <tr><td>변속기</td><td id="rc-transmission">-</td></tr>
                  <tr><td>연비</td><td id="rc-fuelEconomy">-</td></tr>
                  <tr><td>승차정원</td><td id="rc-seatCapacity">-</td></tr>
                  <tr><td>현금 영수증</td><td id="rc-cashReceipt">-</td></tr>
                </table>
              </div>
            </div>
            
            <div class="option-card">
              <div class="option-card-header">옵션</div>
              <table class="option-table">
                <tr>
                  <td>전 기</td>
                  <td><div class="electric-items"><span id="rc-battery">-</span><span id="rc-solar">-</span><span id="rc-inverter">-</span></div></td>
                </tr>
                <tr><td>외 관</td><td id="rc-exterior">-</td></tr>
                <tr><td>내 장</td><td id="rc-interior">-</td></tr>
                <tr><td>편 의</td><td id="rc-convenience">-</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 카라반 결과 -->
    <div id="caravan-result" class="result-panel">
      <div class="modal-container">
        <div class="modal-header">
          <button class="btn btn-primary" onclick="switchSubTab('input')">← 수정</button>
          <button class="btn btn-download" onclick="downloadPNG('caravan')">PNG 다운로드</button>
        </div>
        <div class="modal-body">
          <div id="caravan-result-container">
            <div class="result-grid">
              <div class="result-card">
                <div class="result-card-header">차량 정보</div>
                <table class="result-table">
                  <tr><td>제조사</td><td id="rv-manufacturer">-</td></tr>
                  <tr><td>모델명</td><td id="rv-modelName">-</td></tr>
                  <tr><td>차종</td><td id="rv-vehicleType">-</td></tr>
                  <tr><td id="rv-yearLabel">연식</td><td id="rv-year">-</td></tr>
                  <tr><td>최초등록일</td><td id="rv-firstReg">-</td></tr>
                  <tr><td>차고지 증명</td><td id="rv-garageProof">-</td></tr>
                  <tr><td>취침인원</td><td id="rv-sleepCapacity">-</td></tr>
                  <tr><td>현금 영수증</td><td id="rv-cashReceipt">-</td></tr>
                </table>
              </div>
              <div class="result-card">
                <div class="result-card-header">제원</div>
                <table class="result-table">
                  <tr><td>외부 길이</td><td id="rv-extLength">-</td></tr>
                  <tr><td>내부 길이</td><td id="rv-intLength">-</td></tr>
                  <tr><td>외부 너비</td><td id="rv-extWidth">-</td></tr>
                  <tr><td>내부 너비</td><td id="rv-intWidth">-</td></tr>
                  <tr><td>외부 높이</td><td id="rv-extHeight">-</td></tr>
                  <tr><td>내부 높이</td><td id="rv-intHeight">-</td></tr>
                  <tr><td>공차 중량</td><td id="rv-curbWeight">-</td></tr>
                  <tr><td>최대 허용 중량</td><td id="rv-maxWeight">-</td></tr>
                </table>
              </div>
            </div>
            
            <div class="option-card">
              <div class="option-card-header">옵션</div>
              <table class="option-table">
                <tr>
                  <td>전 기</td>
                  <td><div class="electric-items"><span id="rv-battery">-</span><span id="rv-solar">-</span><span id="rv-inverter">-</span></div></td>
                </tr>
                <tr><td>외 관</td><td id="rv-exterior">-</td></tr>
                <tr><td>내 장</td><td id="rv-interior">-</td></tr>
                <tr><td>편 의</td><td id="rv-convenience">-</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let currentMainTab = 'camper';
    let currentSubTab = 'input';
    
    function switchMainTab(tab) {
      currentMainTab = tab;
      document.querySelectorAll('.main-tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.main-tab-btn[onclick="switchMainTab('${tab}')"]`).classList.add('active');
      updatePanelVisibility();
    }
    
    function switchSubTab(tab) {
      currentSubTab = tab;
      document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.sub-tab-btn[onclick="switchSubTab('${tab}')"]`).classList.add('active');
      if (tab === 'result') updateResult();
      updatePanelVisibility();
    }
    
    function updatePanelVisibility() {
      document.querySelectorAll('.form-panel, .result-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(`${currentMainTab}-${currentSubTab}`).classList.add('active');
    }
    
    function formatNumber(value) {
      if (!value) return '';
      const num = value.toString().replace(/[^\d.]/g, '');
      const parts = num.split('.');
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return parts.join('.');
    }
    
    function parseYear(value) {
      if (!value) return { label: '연식', value: '-' };
      const trimmed = value.trim();
      if (trimmed.includes('.')) {
        const [year, month] = trimmed.split('.');
        return { label: '제작연월', value: `${year} 년 ${parseInt(month)} 월` };
      }
      return { label: '연식', value: `${trimmed} 년` };
    }
    
    function parseFirstReg(value) {
      if (!value) return '-';
      const trimmed = value.trim();
      if (trimmed.includes('.')) {
        const [year, month] = trimmed.split('.');
        return `${year} 년 ${parseInt(month)} 월`;
      }
      return `${trimmed} 년`;
    }
    
    function formatOptions(text) {
      if (!text || !text.trim()) return '-';
      const items = text.split(/\s{2,}/).filter(item => item.trim());
      if (items.length === 0) return '-';
      return '• ' + items.join(' • ');
    }
    
    function updateResult() {
      if (currentMainTab === 'camper') updateCamperResult();
      else updateCaravanResult();
    }
    
    function updateCamperResult() {
      ['baseVehicle', 'manufacturer', 'modelName', 'vehicleType', 'garageProof', 'license', 'fuel', 'transmission', 'cashReceipt'].forEach(f => {
        const el = document.getElementById('rc-' + f);
        if (el) el.textContent = document.getElementById('c-' + f).value || '-';
      });
      
      const yearData = parseYear(document.getElementById('c-year').value);
      document.getElementById('rc-yearLabel').textContent = yearData.label;
      document.getElementById('rc-year').textContent = yearData.value;
      
      document.getElementById('rc-firstReg').textContent = parseFirstReg(document.getElementById('c-firstReg').value);
      
      const mileage = document.getElementById('c-mileage').value;
      document.getElementById('rc-mileage').textContent = mileage ? `${formatNumber(mileage)} km` : '-';
      
      document.getElementById('rc-length').textContent = document.getElementById('c-length').value ? `${formatNumber(document.getElementById('c-length').value)} mm` : '-';
      document.getElementById('rc-width').textContent = document.getElementById('c-width').value ? `${formatNumber(document.getElementById('c-width').value)} mm` : '-';
      document.getElementById('rc-height').textContent = document.getElementById('c-height').value ? `${formatNumber(document.getElementById('c-height').value)} mm` : '-';
      document.getElementById('rc-displacement').textContent = document.getElementById('c-displacement').value ? `${formatNumber(document.getElementById('c-displacement').value)} cc` : '-';
      document.getElementById('rc-fuelEconomy').textContent = document.getElementById('c-fuelEconomy').value ? `등록증상 ${document.getElementById('c-fuelEconomy').value} km/L` : '-';
      document.getElementById('rc-seatCapacity').textContent = document.getElementById('c-seatCapacity').value ? `${document.getElementById('c-seatCapacity').value} 인` : '-';
      
      const bt = document.getElementById('c-batteryType').value;
      const bc = document.getElementById('c-batteryCapacity').value;
      document.getElementById('rc-battery').textContent = (bt && bc) ? `${bt} ${formatNumber(bc)} Ah` : '-';
      
      const solar = document.getElementById('c-solar').value;
      document.getElementById('rc-solar').textContent = solar ? `태양광 ${formatNumber(solar)} W` : '-';
      
      const inverter = document.getElementById('c-inverter').value;
      document.getElementById('rc-inverter').textContent = inverter ? `인버터 ${formatNumber(inverter)} Kw` : '-';
      
      document.getElementById('rc-exterior').textContent = formatOptions(document.getElementById('c-exterior').value);
      document.getElementById('rc-interior').textContent = formatOptions(document.getElementById('c-interior').value);
      document.getElementById('rc-convenience').textContent = formatOptions(document.getElementById('c-convenience').value);
    }
    
    function updateCaravanResult() {
      ['manufacturer', 'modelName', 'vehicleType', 'garageProof', 'cashReceipt'].forEach(f => {
        const el = document.getElementById('rv-' + f);
        if (el) el.textContent = document.getElementById('v-' + f).value || '-';
      });
      
      const yearData = parseYear(document.getElementById('v-year').value);
      document.getElementById('rv-yearLabel').textContent = yearData.label;
      document.getElementById('rv-year').textContent = yearData.value;
      
      document.getElementById('rv-firstReg').textContent = parseFirstReg(document.getElementById('v-firstReg').value);
      
      document.getElementById('rv-sleepCapacity').textContent = document.getElementById('v-sleepCapacity').value ? `${document.getElementById('v-sleepCapacity').value} 인` : '-';
      
      ['extLength', 'intLength', 'extWidth', 'intWidth', 'extHeight', 'intHeight'].forEach(f => {
        const val = document.getElementById('v-' + f).value;
        document.getElementById('rv-' + f).textContent = val ? `${formatNumber(val)} mm` : '-';
      });
      
      document.getElementById('rv-curbWeight').textContent = document.getElementById('v-curbWeight').value ? `${formatNumber(document.getElementById('v-curbWeight').value)} kg` : '-';
      document.getElementById('rv-maxWeight').textContent = document.getElementById('v-maxWeight').value ? `${formatNumber(document.getElementById('v-maxWeight').value)} kg` : '-';
      
      const bt = document.getElementById('v-batteryType').value;
      const bc = document.getElementById('v-batteryCapacity').value;
      document.getElementById('rv-battery').textContent = (bt && bc) ? `${bt} ${formatNumber(bc)} Ah` : '-';
      
      const solar = document.getElementById('v-solar').value;
      document.getElementById('rv-solar').textContent = solar ? `태양광 ${formatNumber(solar)} W` : '-';
      
      const inverter = document.getElementById('v-inverter').value;
      document.getElementById('rv-inverter').textContent = inverter ? `인버터 ${formatNumber(inverter)} Kw` : '-';
      
      document.getElementById('rv-exterior').textContent = formatOptions(document.getElementById('v-exterior').value);
      document.getElementById('rv-interior').textContent = formatOptions(document.getElementById('v-interior').value);
      document.getElementById('rv-convenience').textContent = formatOptions(document.getElementById('v-convenience').value);
    }
    
    async function downloadPNG(type) {
      const container = document.getElementById(`${type}-result-container`);
      
      if (!container) {
        alert('컨테이너를 찾을 수 없습니다.');
        return;
      }
      
      try {
        // 컨텐츠를 캔버스로 변환
        const contentCanvas = await html2canvas(container, { 
          scale: 2, 
          backgroundColor: '#ffffff', 
          useCORS: true,
          logging: false
        });
        
        // 정사각형 크기 계산
        const padding = 40;
        const size = Math.max(contentCanvas.width, contentCanvas.height) + padding * 2;
        
        // 정사각형 캔버스 생성
        const squareCanvas = document.createElement('canvas');
        squareCanvas.width = size;
        squareCanvas.height = size;
        const ctx = squareCanvas.getContext('2d');
        
        // 흰색 배경
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, size, size);
        
        // 컨텐츠를 중앙에 배치
        const x = (size - contentCanvas.width) / 2;
        const y = (size - contentCanvas.height) / 2;
        ctx.drawImage(contentCanvas, x, y);
        
        // Blob으로 변환 후 다운로드
        squareCanvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const modelName = document.getElementById(type === 'camper' ? 'c-modelName' : 'v-modelName').value || '옵션표';
          
          const link = document.createElement('a');
          link.href = url;
          link.download = `${modelName}_옵션표.png`;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          
          setTimeout(() => {
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          }, 100);
        }, 'image/png');
        
      } catch (e) {
        console.error(e);
        alert('PNG 생성 실패: ' + e.message);
      }
    }
    
    function resetForm(type) {
      if (!confirm('입력 내용을 모두 지우시겠습니까?')) return;
      const prefix = type === 'camper' ? 'c-' : 'v-';
      document.querySelectorAll(`[id^="${prefix}"]`).forEach(el => {
        if (el.tagName === 'SELECT') el.selectedIndex = 0;
        else el.value = '';
        localStorage.removeItem(el.id);
      });
    }
    
    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('input', () => localStorage.setItem(el.id, el.value));
      el.addEventListener('change', () => localStorage.setItem(el.id, el.value));
      const saved = localStorage.getItem(el.id);
      if (saved) el.value = saved;
    });
    
    // 모달 외부 클릭시 닫기
    document.querySelectorAll('.result-panel').forEach(panel => {
      panel.addEventListener('click', (e) => {
        if (e.target === panel) {
          switchSubTab('input');
        }
      });
    });
    
    // ESC 키로 모달 닫기
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && currentSubTab === 'result') {
        switchSubTab('input');
      }
    });
  </script>
</body>
</html>
